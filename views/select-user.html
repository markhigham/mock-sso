{% extends "base.html" %}
{% block header_scripts %}
<script>
  document.body.className = document.body.className ? document.body.className + " js-enabled" : "js-enabled";

  function remove(emailUserId, email) {
    if (!confirm(`Delete ${email}`)) return;
    setFormEmailUserId(emailUserId);
    const button = document.getElementById("removeButton");
    button.click();
  }

  function setFormEmailUserId(emailUserId) {
    const form = document.getElementById("loginForm");
    const emailInput = document.getElementById("emailUserId");
    emailInput.value = emailUserId;
    return form;
  }

  function login(emailUserId) {
    const form = setFormEmailUserId(emailUserId);
    form.submit();
  }

</script>
{% endblock %}
{% block content %}

    {% if users.length %}
    <h1 class="govuk-heading-l">Login as an existing user</h1>

    <form id="loginForm" method="post" action="/select-user" style="display: none">
      <input type="text" value="{{ redirectUri }}" name="redirectUri" />
      <input type="text" name="email_user_id" id="emailUserId" />
      <button type="submit" name="submit_button" value="remove-user" id="removeButton">Remove</button>
    </form>

    <div class="govuk-grid-row govuk-!-margin-bottom-8">
      <div class="govuk-grid-column-full">
        <div style="max-height: 30rem; overflow-y: scroll">
          <dl class="govuk-summary-list">
            {% for user in users %}
            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                <a onclick="login('{{ user.email_user_id }}')" class="govuk-link__fake" style="font-weight: bold">
                  {{ user.first_name }} {{ user.last_name }}
                </a>
              </dt>

              <dd class="govuk-summary-list__value">{{ user.email }}</dd>

              <dd class="govuk-summary-list__actions">
                <a class="govuk-link__fake" onclick="remove('{{ user.email_user_id }}', '{{ user.email }}')">
                  Remove</a>
              </dd>
            </div>
            {% endfor %}
          </dl>
        </div>
      </div>
    </div>
    {% endif %}

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h2 class="govuk-heading-l">Login as a new user</h2>

        <form action="/create-user" method="post">
          <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-half">
              <div class="govuk-form-group">
                <label class="govuk-label" for="first_name">First name</label>
                <input type="text" class="govuk-input" id="first_name" name="first_name" required />
              </div>
            </div>
            <div class="govuk-grid-column-one-half">
              <div class="govuk-form-group">
                <label class="govuk-label" for="last_name">Last name</label>
                <input type="text" class="govuk-input" id="last_name" name="last_name" required />
              </div>
            </div>
          </div>
          <div class="govuk-form-group">
            <label class="govuk-label" for="email">Email</label>
            <input type="email" class="govuk-input govuk-input--width-20" id="email" name="email" required />
          </div>
          <div class="govuk-form-group">
            <input type="hidden" value="{{ redirectUri }}" name="redirectUri" />
            <input type="submit" class="govuk-button" value="Create and login" />
          </div>
        </form>
      </div>
    </div>

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <h2 class="govuk-heading-l">Manage your users</h2>

        <p class="govuk-body">
          <a href="/download" class="govuk-link govuk-link--no-visited-state">Download</a> your users as a JSON file for
          later uploading.
        </p>

        <p class="govuk-body">
          <a class="govuk-link govuk-link__fake">Upload</a> your users from a JSON file.
          <form method="post" action="/upload" enctype="multipart/form-data">
          <input type="file" accept="application/json,*.json" name="users" />
          <input type="text" value="{{ redirectUri }}" name="redirectUri" />
        <input type="submit"/>
          </form>
        </p>
      </div>
    </div>

{% endblock %}
